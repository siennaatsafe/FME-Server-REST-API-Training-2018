### 6.2 Working with Resources

<table style="border-spacing: 0px;border-collapse: collapse;font-family:serif">
<tr>
<td width=25% style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold">Exercise 10 </span>
</td>
<td style="border: 2px solid darkorange;background-color:darkorange;color:white">
<span style="color:white;font-size:x-large;font-weight: bold"> Working with Resources</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Data</td>
<td style="border: 1px solid darkorange">C:\FMEData2018\Data\CellSignals\CellSignal.csv
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Overall Goal</td>
<td style="border: 1px solid darkorange"> To demonstrate how to upload a file and download a file using the REST API. </td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Demonstrates</td>
<td style="border: 1px solid darkorange"> The calls for managing resources </td>
</tr>

</table>

Through the REST API, you will have access to the Resources available in
the FME Server. You can list files, upload files, and delete files all
using the REST API. This is helpful in a web application if you would
like to direct data to a certain area in the FME Server.

#### Uploading a File

This call will upload a file to the data folder in your resources
folder. The filename is specified in the Content-Disposition parameter.
If you wanted to specify a directory in the data folder simply write the
folder name after filesys.

** 1) Enter the following URL and Headers into Postman  **

    POST http://localhost/fmerest/v3/resources/connections/FME_SHAREDRESOURCE_DATA/filesys/
    Content-Type: application/octect-stream
    Accept: application/json
    Content-Disposition: attachment; filename= “uploadingfiles.csv”
    Authorization: fmetoken token= [INSERT TOKEN HERE]

** 2) Switch to the Body Tab in Postman**

To use this call, you will need to upload the workspace in the body of
the call. To use this in Postman click on the body tab, then binary and
choose the workspace you will like to upload.

** 3) Select Binary and Select the File**

______________

Optional Query String Parameters

<table>

<tr>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>

</tr>

<tr>
<td>createDirectories</td>
<td> True | **false** </td>
<td>Create directories in the path if they do not exist</td>



<tr>
<td>overwrite</td>
<td>True | **false**</td>
<td> Overwrite the file if it already exists </td>

</tr>

</table>

_________________________________-


#### Listing Files

This call will list the files in a resource

** 4) Enter in the Following URL and Headers in Postman**


    GET http://localhost/fmerest/v3/resources/connections/FME\_SHAREDRESOURCE\_TEMP/filesys/\
    Accept: application/json
    Authorization: fmetoken token= [INSERT TOKEN HERE]

** 5) View the Response in Postman**

    {
    "date": "2016-01-21T20:40:03",
    "path": "/",
    "size": 0,
    "contents": [
    {
      "date": "2016-01-21T20:40:03",
      "path": "/",
      "size": 1,
      "name": "output.txt",
      "type": "FILE"
    },
    {
      "date": "2016-01-21T20:13:12",
      "path": "/",
      "size": 0,
      "name": "sampledata",
      "type": "DIR"
    }
    ],
    "name": "",
    "type": "DIR"
        }

#### Downloading File

This call downloads a file from a resource connection either as an
inline resource or as an attachment. The 'disposition' parameter is
only relevant for some REST clients. In particular, Internet Explorer
behaves poorly without an attachment disposition header. This web page
will only display the response body instead of downloading the file, so
REST clients should inspect the Content-Disposition header and handle
the download.

This call will look into the Resources/Data directory to find uploadingfiles.csv.

    POST http://localhost/fmerest/v3/resources/connections/FME_SHAREDRESOURCE_DATA/download/uploadingfiles.csv

    Accept: application/octet-stream
    Authorization: fmetoken token= [INSERT TOKEN HERE]
    Content-Type: application/x-www-form-urlendcoded

    Request Body
    accept=contents&disposition=inline


**Parameters**

<table>

<tr>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>

</tr>

<tr>
<td>disposition</td>
<td> inline/attachment </td>
<td>Inline will display the Specifies how to retrieve the resource using the 'Content-Disposition' header. This parameter is only relevant for some REST clients (primarily web browsers). If no disposition is selected, then a header is not set.</td>



<tr>
<td>Path</td>
<td></td>
<td> Path, relative to the resource connection (for example, uploading.csv) </td>

<tr>
<td>Resource</td>
<td></td>
<td>Name of a resource connection. Can contain only alphanumeric characters. (for example, FME_SHAREDRESOURCE_DATA) </td>


</tr>

</table>

<br>
<br>
<br>
____________________

<table style="border-spacing: 0px;border-collapse: collapse;font-family:serif">
<tr>
<td width=25% style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold">Exercise 11 </span>
</td>
<td style="border: 2px solid darkorange;background-color:darkorange;color:white">
<span style="color:white;font-size:x-large;font-weight: bold"> Using a Shared Resource as a Workspace Output Location</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Data</td>
<td style="border: 1px solid darkorange">C:\FMEData2018\Data\Planning\BusinessLicenses.xlsx</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Overall Goal</td>
<td style="border: 1px solid darkorange"> To demonstrate how to upload a file and download a file using the REST API. </td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Demonstrates</td>
<td style="border: 1px solid darkorange"> The calls for managing resources </td>
</tr>
<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Workspace</td>
<td style="border: 1px solid darkorange"> C:\FMEData2018\Workspaces\RESTAPITraining\Chapter6Exercise11 </td>
</tr>


</table>




If you wish to retrieve the result dataset from a workspace through the
REST API, the best method is to write it to a shared resource location
that is accessible to the client. In this example we will make a
workspace, then run a call while changing the output to the Temporary
Repository. We will use a very basic workspace to test this out.

1.  Open FME Workbench and start a blank workspace. Add a Microsoft
    Excel reader, with a test Excel file. Then add CSV writer to the
    workspace. It is okay to accept the default parameters.


![](./Images/image6.2.1.Excel.png)
*Image 6.2.1 Excel to CSV Workspace*

2.  The next step is to identify the Published parameter of the
    destination dataset. In my case, it is called DestDataset\_CSV2.
    Under this parameter, I set the destination to be,
    $(FME\_SHAREDRESOURCE\_TEMP)

3.  For the input data source, I uploaded the data to the server
    manually and created a private parameter where the data is stored.
    I directed the data to the folder listed below.
    $(FME\_SHAREDRESOURCE\_DATA)/SharedResourceTest/BusinessLicenses.xlsx

4.  Publish the Workspace to your FME Server. I saved mine to a Tester
    Repository under the name sharedresourcetest.fmw

5.  Open Postman and create the following POST call.

**Request**

    POST
    http://localhost/fmerest/v3/transformations/submit/Tester/sharedresourcetest.fmw
    Accept: application/json
    Content-Type: application/json
    Authorization: fmetoken token= YOUR TOKEN

    {
    "publishedParameters": [
    {
      "name": "DestDataset_CSV2",
      "value": "$(FME_SHAREDRESOURCE_TEMP)"
    }
    ],
    "subsection": "REST_SERVICE"
     }


**Response**

    {

    "id": 88

    }

This call will run asynchronously so in return you will receive an id.
To check that your call has been completed, use this call.

    GET http://localhost/fmerest/v3/transformations/jobs/id/88
    Accept: application/json
    Authorization: fmetoken token= YOUR TOKEN


Then you can download the file using the call below.

     POST http://localhost/fmerest/v3/resources/connections/FME_SHAREDRESOURCE_TEMP/download/Business_Licences.csv

    Accept: application/octet-stream
    Authorization: fmetoken token= YOUR TOKEN
    Content-Type: application/x-www-form-urlendcoded

    Request Body
    accept=contents&disposition=inline


While Postman can process the call the CSV file cannot be downloaded.
