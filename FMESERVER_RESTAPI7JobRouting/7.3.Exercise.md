### 7.3 Creating a Workspace to Retrieve Job History Results

<table style="border-spacing: 0px;border-collapse: collapse;font-family:serif">
<tr>
<td width=25% style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold">Exercise 12 </span>
</td>
<td style="border: 2px solid darkorange;background-color:darkorange;color:white">
<span style="color:white;font-size:x-large;font-weight: bold"> Create a Workspace to Retrieve Job History Results</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Data</td>
<td style="border: 1px solid darkorange">None</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Overall Goal</td>
<td style="border: 1px solid darkorange">  </td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Demonstrates</td>
<td style="border: 1px solid darkorange"> </td>
</tr>
<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Workspace</td>
<td style="border: 1px solid darkorange"> </td>
</tr>


</table>

For this exercise, we are going to create a workspace that retrieves the
job history from your FME Server and creates an HTML file with the
results. The first workspace we will create retrieves the latest 1000
jobs from the FME Server. Then the results are formatted into a table
with the results and beneath this, there will be a chart with the number
of results by date.

**Step 1. Use the HTTPCaller to Get Jobs and then Format the
Attributes**

![](./Images/image7.3.1.Step1.png)

*Image 7.3.1- Step 1*

-   As with the previous exercise, we will start with the Creator
    reader. It is okay to leave the defaults for this.

-   Next, add the HTTPCaller and set the parameters as listed below:

        Request URL: http://YOURSERVER/fmerest/v3/transformations/jobs/completed
        HTTP Method: GET


![](./Images/image7.3.2.HTTPParam.png)

*Image 7.3.2 HTTP Caller Parameters*

![](./Images/image7.3.3.HTTPAuth.png)

*Image 7.3.3 HTTP Caller Authentication*

-   If you attach an inspector at this point, you can see the entire
    response with all the jobs is stored in the response body
    attribute. If you open double click on the response body to
    examine it you will see:

![](./Images/image7.3.4.HTTPResponse.png)

*Image 7.3.4 HTTP Caller Response*

-   We need to parse the response to get the information we want into
     attributes we can use. For this exercise, we are going to keep the
    id, timeSubmitted, and status.

<!-- -->

-   We are going to use the JSONFragmenter to parse the needed
    attributes into the needed attributes.

![](./Images/image7.3.5.JSONFrag.png)

*Image 7.3.5 JSONFragmenter Parameters*

-   The JSON Attribute is the response body which is produced from the
    previous call

-   For the JSON Query, we want to find all the responses in the items
    category therefore, we use this statement json\["items"\]\[\*\]

-   Next, we need to set up the Flattening Parameters in the
    JSONFragmenter.

![](./Images/image7.3.6.FlatParam.png)

*Image 7.3.6 Flattening Parameters*

-   Here, we enter the attributes we would like to keep from the query.
    You should keep the id, timeSubmitted, and status.

-   Next, add the AttributeKeeper. Under parameters and Attributes to
    Keep write timeSubmitted, id, status.

![](./Images/image7.3.7.AttKeep.png)

*Image 7.3.7 Attribute Keeper Parameters*

**Step 2. Format Dates**

![](./Images/image7.3.8.Step2.png)

*Image 7.3.8- Step 2*

-   Use the DateTimeConverter to format the dates into the appropriate
    format.

![](./Images/image7.3.9.DateTime.png)

*Image 7.3.9 DateTime Converter*

**Step 3. Create a Table with the Job History Results**

![](./Images/image7.3.10.Step3.png)

*Image 7.3.10- Step 3*

-   If we compiled a table with the result currently, it would create a
    table however, it would not have an order so we use the Sorter
    transformer. The Sorter transformer will be connected to the
    DateTimeConverter. Under the Sort By section list the following
    parameters:

![](./Images/image7.3.11.Sorter.png)

*Image 7.3.11- Sorter Parameters*

-   Next, add the HTMLReportGenerator, this is where we can create the
    table used.

![](./Images/image7.3.12.HTMLReportGen.png)

*Image 7.3.12- HTML Report Generator Parameters*

-   First, we want to add Custom HTML to specify the header on our HTML
    file.


    <h2><strong>Monthly Server Report</strong></h2>


-   If you had an introduction or any formatting, you could place it
    here as well.

-   Next, under page contents, we would add a Table. Here, you may
    specify the column contents and headings the table will use.

![](./Images/image7.3.13.HTMLTableParam.png)

*Image 7.3.13- HTML Report Generator Table Parameters*

-   To view the table before it is created, click the Preview in Browser
    button.

**Step 4. Create a Bar Chart with Jobs by Date**

![](./Images/image7.3.14.Step4.png)

*Image 7.3.14- Step 4*

-   Add the Aggregator transformer and attach it to the
    DateTimeConverter.

-   We need to aggregate all jobs by date to create the bar chart so we
    need the Aggregator.

![](./Images/image7.3.15.Aggregator.png)

*Image 7.3.15- Aggregator Parameters*

-   Here, we are grouping the results by timeSubmitted which is the date
    the attributes were submitted. Then under Count Attribute, we
    create a new Attribute named DateCount.

-   Next, we attach another HTMLReportGenerator. The parameters are set
    up below:

![](./Images/image7.3.16.png)

*Image 7.3.16- HTML Report Generator Chart Parameters*

**Step 5. Format the Layout and Write to HTML**

![](./Images/image7.3.17.Step5.png)

*Image 7.3.17- Step 5*

Now both of the charts created are sent to the HTML Layouter.

![](./Images/image7.3.18.HTMLLayouter.png)

*Image 7.3.18- HTML Layouter Parameters*

Finally, you can write the HTML to the location of your choice.

To view the final product simply open the folder it is stored in and
open the file in any browser.
