### 8.3 Creating a Workspace to Retrieve Job History Results

For this exercise, we are going to create a workspace that retrieves the
job history from your FME Server and creates an HTML file with the
results. The first workspace we will create retrieves the latest 1000
jobs from the FME Server. Then the results are formatted into a table
with the results and beneath this, there will be a chart with the number
of results by date.

**Step 1. Use the HTTPCaller to Get Jobs and then Format the
Attributes**

![](media/image157.png){width="6.5in" height="1.9861111111111112in"}

*Image 8.3.1- Step 1*

-   As with the previous exercise, we will start with the Creator
    > reader. It is okay to leave the defaults for this.

-   Next, add the HTTPCaller and set the parameters as listed below:

+-----------------------------------------------------------------------+
| Request URL:                                                          |
| [[http://YOURSERVER/fmerest/v3/transformations/jobs/completed]{.under |
| line}](http://yourserver/fmerest/v3/transformations/jobs/completed)   |
|                                                                       |
| HTTP Method: GET                                                      |
+-----------------------------------------------------------------------+

![](media/image154.png){width="3.3680555555555554in"
height="1.8520395888013998in"}

*Image 8.3.2 HTTP Caller Parameters*

![](media/image26.png){width="4.201388888888889in"
height="1.030148731408574in"}

*Image 8.3.3 HTTP Caller Authentication *

-   If you attach an inspector at this point, you can see the entire
    > response with all the jobs is stored in the response body
    > attribute. If you open double click on the response body to
    > examine it you will see:

![](media/image103.png){width="4.229166666666667in"
height="1.7316961942257219in"}

*Image 8.3.4 HTTP Caller Response*

-   We need to parse the response to get the information we want into
    > attributes we can use. For this exercise, we are going to keep the
    > id, timeSubmitted, and status.

<!-- -->

-   We are going to use the JSONFragmenter to parse the needed
    > attributes into the needed attributes.

![](media/image78.png){width="3.797146762904637in"
height="1.203125546806649in"}

*Image 8.3.5 JSONFragmenter Parameters*

-   The JSON Attribute is the response body which is produced from the
    > previous call

-   For the JSON Query, we want to find all the responses in the items
    > category therefore, we use this statement json\["items"\]\[\*\]

-   Next, we need to set up the Flattening Parameters in the
    > JSONFragmenter.

![](media/image30.png){width="6.5in" height="1.1666666666666667in"}

*Image 8.3.6 Flattening Parameters*

-   Here, we enter the attributes we would like to keep from the query.
    > You should keep the id, timeSubmitted, and status.

-   Next, add the AttributeKeeper. Under parameters and Attributes to
    > Keep write timeSubmitted, id, status.

![](media/image35.png){width="3.5347222222222223in"
height="1.8701148293963255in"}

*Image 8.3.7 Attribute Keeper Parameters*

**Step 2. Format Dates**

![](media/image145.png){width="1.4027777777777777in"
height="1.5324464129483815in"}

*Image 8.3.8- Step 2*

-   Use the DateTimeConverter to format the dates into the appropriate
    > format.

![](media/image160.png){width="4.034722222222222in"
height="2.6186898512685914in"}

*Image 8.3.9 DateTime Converter*

**Step 3. Create a Table with the Job History Results**

![](media/image62.png){width="4.0in" height="0.9791666666666666in"}

*Image 8.3.10- Step 3*

-   If we compiled a table with the result currently, it would create a
    > table however, it would not have an order so we use the Sorter
    > transformer. The Sorter transformer will be connected to the
    > DateTimeConverter. Under the Sort By section list the following
    > parameters:

![](media/image135.png){width="3.9583333333333335in"
height="0.9270833333333334in"}

*Image 8.3.11- Sorter Parameters*

-   Next, add the HTMLReportGenerator, this is where we can create the
    > table used.

![](media/image7.png){width="6.5in" height="0.6527777777777778in"}

*Image 8.3.12- HTML Report Generator Parameters*

-   First, we want to add Custom HTML to specify the header on our HTML
    > file.

  ---------------------------------------------------------
  \<h2\>\<strong\>Monthly Server Report\</strong\>\</h2\>
  ---------------------------------------------------------

-   If you had an introduction or any formatting, you could place it
    > here as well.

-   Next, under page contents, we would add a Table. Here, you may
    > specify the column contents and headings the table will use.

![](media/image27.png){width="3.5625in" height="1.4096773840769903in"}

*Image 8.3.13- HTML Report Generator Table Parameters*

-   To view the table before it is created, click the Preview in Browser
    > button.

**Step 4. Create a Bar Chart with Jobs by Date**

![](media/image61.png){width="4.125in" height="0.9895833333333334in"}

*Image 8.3.14- Step 4*

-   Add the Aggregator transformer and attach it to the
    > DateTimeConverter.

-   We need to aggregate all jobs by date to create the bar chart so we
    > need the Aggregator.

![](media/image158.png){width="5.034722222222222in"
height="2.1704166666666667in"}

*Image 8.3.15- Aggregator Parameters*

-   Here, we are grouping the results by timeSubmitted which is the date
    > the attributes were submitted. Then under Count Attribute, we
    > create a new Attribute named DateCount.

-   Next, we attach another HTMLReportGenerator. The parameters are set
    > up below:

![](media/image131.png){width="6.5in" height="2.0694444444444446in"}

*Image 8.3.16- HTML Report Generator Chart Parameters*

**Step 5. Format the Layout and Write to HTML**

![](media/image34.png){width="4.465277777777778in"
height="2.1315726159230097in"}

*Image 8.3.17- Step 5*

Now both of the charts created are sent to the HTML Layouter.

![](media/image108.png){width="1.9930555555555556in"
height="2.465546806649169in"}

*Image 8.3.18- HTML Layouter Parameters*

Finally, you can write the HTML to the location of your choice.

To view the final product simply open the folder it is stored in and
open the file in any browser.
